{% extends 'layout/templates_home.html' %} {% block style %}
<link
    rel="stylesheet"
    href="{{ url_for('static', filename='home/dist/css/style.css') }}"
/>
<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/sweetalert2@10.15.6/dist/sweetalert2.min.css"
/>
<link
    rel="stylesheet"
    href="{{ url_for('static', filename='home/alert.css') }}"
/>
<link
    rel="stylesheet"
    href="{{ url_for('static', filename='home/estetik.css') }}"
/>
{% endblock style %} {% block content %}
<header class="main-header position-fixed w-100">
    <div class="container">{% include 'components/nav_home.html' %}</div>
    <div
        class="offcanvas offcanvas-start"
        tabindex="-1"
        id="offcanvasExample"
        aria-labelledby="offcanvasExampleLabel"
    >
        <div class="offcanvas-header">
            <div class="logo">
                <a
                    class="navbar-brand py-0 me-0"
                    href="#"
                    ><img
                        src="../assets/images/Creato-logo.svg"
                        alt=""
                /></a>
            </div>
            <button
                type="button"
                class="btn-close text-reset ms-auto"
                data-bs-dismiss="offcanvas"
                aria-label="Close"
            >
                <i class="ti ti-x text-warning"></i>
            </button>
        </div>
        <div class="offcanvas-body pt-0">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a
                        class="nav-link text-capitalize"
                        aria-current="page"
                        href="#"
                        >Services</a
                    >
                </li>
                <li class="nav-item">
                    <a
                        class="nav-link text-capitalize"
                        href="#"
                        >Pricing</a
                    >
                </li>
                <li class="nav-item">
                    <a
                        class="nav-link text-capitalize"
                        href="#"
                        >Pricing
                    </a>
                </li>
                <li class="nav-item">
                    <a
                        class="nav-link text-capitalize"
                        href="#"
                        >Elements
                    </a>
                </li>
                <li class="nav-item">
                    <a
                        class="nav-link text-capitalize"
                        href="#"
                        >blog
                    </a>
                </li>
            </ul>
            <div class="login d-block align-items-center mt-3">
                <a
                    class="btn btn-warning text-capitalize w-100"
                    href="#"
                    >contact us</a
                >
            </div>
        </div>
    </div>
</header>
<section
    id="profil"
    class="service position-relative overflow-hidden"
>
    <div class="container position-relative">
        <div class="section-title">
            <h2>Absensi</h2>
            <p>Hadapkan wajah pada kamera.</p>
        </div>
        <div class="row mt-5 mb-5">
            <div class="col-md-8">
                <img
                    id="videoElement"
                    width="100%"
                    class="img-thumbnail"
                />
            </div>

            <div
                class="col-md-4"
                style="height: 500px; overflow-y: auto"
            >
                <!-- <button id="markAttendanceButton">Mark Attendance</button> -->
                <button
                    id="aksesMasukButton"
                    onclick="aksesMasuk()"
                    class="estetik-button"
                >
                    Absen Masuk
                </button>
                <button
                    id="aksesPulangButton"
                    onclick="aksesPulang()"
                    class="estetik-button"
                >
                    Absen Pulang
                </button>
                <!-- <button
                    id="aksesIstirahatButton"
                    onclick="aksesIstirahat()"
                >
                    Akses Istirahat
                </button> -->

                <!-- <h3>Today Scan</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Person #</th>
                            <th>Name</th>
                            <th>Skill</th>
                            <th>Added</th>
                        </tr>
                    </thead>
                    <tbody id="scandata"></tbody>
                </table> -->

                <h1>Identitas Karyawan</h1>
                <div id="karyawan-container">
                    <p>Nama: {{ nama }}</p>
                    <p>Jabatan: {{ jabatan }}</p>
                    <p>Nidn / Nipy: {{ nidn_nipy }}</p>
                    <p>Jenis Kelamin: {{ jkl }}</p>
                </div>
                <!-- <button onclick="markAttendance()">Tandai Kehadiran</button> -->
            </div>
        </div>
    </div>
</section>

{% endblock content %} {% block script %}

<script src="{{ url_for('static', filename='home/dist/js/custom.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.15.6/dist/sweetalert2.all.min.js"></script>
<script src="{{ url_for('static', filename='home/js/alert.js') }}"></script>
<!-- <script src="{{ url_for('static', filename='home/js/mark_attendance.js') }}"></script> -->

<!-- <script>
    function aksesMasuk() {
        // Make an AJAX request to the server to record entry time
        $.ajax({
            url: '/record_entry_time',
            method: 'POST',
            data: { time: getCurrentTime() },
            success: function (response) {
                console.log('Entry time recorded successfully');
            },
            error: function (error) {
                console.error('Failed to record entry time:', error);
            },
        });
    }

    function aksesPulang() {
        // Make an AJAX request to the server to record home time
        $.ajax({
            url: '/record_home_time',
            method: 'POST',
            data: { time: getCurrentTime() },
            success: function (response) {
                console.log('Home time recorded successfully');
            },
            error: function (error) {
                console.error('Failed to record home time:', error);
            },
        });
    }

    function aksesIstirahat() {
        // Make an AJAX request to the server to record break time
        $.ajax({
            url: '/record_break_time',
            method: 'POST',
            data: { time: getCurrentTime() },
            success: function (response) {
                console.log('Break time recorded successfully');
            },
            error: function (error) {
                console.error('Failed to record break time:', error);
            },
        });
    }

    function getCurrentTime() {
        var now = new Date();
        var currentTime = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();
        return currentTime;
    }
</script> -->
<script>
    var Masuk = "{{ url_for('Absensi.recog_masuk') }}";
</script>
<script>
    var Pulang = "{{ url_for('Absensi.recog_pulang') }}";
</script>

<script src="{{ url_for('static', filename='home/js/absen.js') }}"></script>

<script type="text/javascript">
    $(document).ready(function () {
        let lastcnt = 0;
        let cnt;
        chkNewScan();

        function chkNewScan() {
            countTodayScan();
            setTimeout(chkNewScan, 1000);
        }

        function countTodayScan() {
            $.ajax({
                url: '/absensi/countTodayScan',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    cnt = data.rowcount;
                    if (cnt > lastcnt) {
                        reloadTable();
                    }

                    lastcnt = cnt;
                },
                error: function (result) {
                    console.log('no result!');
                },
            });
        }

        function reloadTable() {
            $.ajax({
                url: '/absensi/loadData',
                type: 'GET',
                dataType: 'json',
                success: function (response) {
                    var tr = $('#scandata');
                    tr.empty();

                    $.each(response, function (index, item) {
                        if (item.length > 0) {
                            for (let i = 0; i < item.length; i++) {
                                tr.append('<tr>' + '<td>' + item[i][1] + '</td>' + '<td>' + item[i][2] + '</td>' + '<td>' + item[i][3] + '</td>' + '<td>' + item[i][4] + '</td>' + '</tr>');
                            }
                        }
                    });
                },
                error: function (result) {
                    console.log('no result!');
                },
            });
        }
    });
</script>

{% endblock script %}
